version: '3.8'

services:
  arguxai:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: arguxai-app
    ports:
      - "8000:8000"
    environment:
      # API Configuration
      - API_KEY=${API_KEY}
      - ENVIRONMENT=production
      
      # DeepSeek AI
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
      - DEEPSEEK_MODEL_CHAT=deepseek-chat
      - DEEPSEEK_MODEL_VISION=deepseek-vl
      
      # GitHub Integration
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - GITHUB_DEFAULT_REPO=${GITHUB_DEFAULT_REPO}
      
      # Figma Integration
      - FIGMA_ACCESS_TOKEN=${FIGMA_ACCESS_TOKEN}
      
      # Jira Integration
      - JIRA_DOMAIN=${JIRA_DOMAIN}
      - JIRA_EMAIL=${JIRA_EMAIL}
      - JIRA_API_TOKEN=${JIRA_API_TOKEN}
      - JIRA_PROJECT_KEY=${JIRA_PROJECT_KEY}
      
      # Convex Database
      - CONVEX_DEPLOYMENT_URL=${CONVEX_DEPLOYMENT_URL}
      - CONVEX_DEPLOY_KEY=${CONVEX_DEPLOY_KEY}
      
      # Configuration
      - DEMO_MODE=false
      - MIN_DROP_PERCENT=12.0
      - MIN_SAMPLE_SIZE=100
      - SIGMA_THRESHOLD=2.0
      
    volumes:
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    mem_limit: 512m
    mem_reservation: 256m
